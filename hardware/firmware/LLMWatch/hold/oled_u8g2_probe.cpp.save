#include <Arduino.h>
#include <U8g2lib.h>
#include <Wire.h>

#ifndef OLED_SDA
#define OLED_SDA 8
#endif
#ifndef OLED_SCL
#define OLED_SCL 9
#endif
#ifndef OLED_ADDR
#define OLED_ADDR 0x3C
#endif

// Try SH1106 first (most 1.3" modules)
U8G2_SH1106_128X64_NONAME_F_HW_I2C u8g2_sh1106(U8G2_R0, /* reset=*/ U8X8_PIN_NONE);
// Fallback to SSD1306 if SH1106 fails
U8G2_SSD1306_128X64_NONAME_F_HW_I2C u8g2_ssd1306(U8G2_R0, /* reset=*/ U8X8_PIN_NONE);

void setup() {
  Serial.begin(115200);
  Wire.begin(OLED_SDA, OLED_SCL, 100000);
  delay(100);

  // Force address and bus to U8g2
  u8g2_sh1106.setI2CAddress(OLED_ADDR<<1);
  if (u8g2_sh1106.begin()) {
    Serial.println("U8g2: SH1106 init OK");
    u8g2_sh1106.clearBuffer();
    u8g2_sh1106.setFont(u8g2_font_6x10_tf);
    u8g2_sh1106.drawStr(0, 12, "SH1106 OK");
    u8g2_sh1106.drawStr(0, 28, "SDA=D8 SCL=D9");
    u8g2_sh1106.drawStr(0, 44, "ADDR 0x3C/0x3D");
    u8g2_sh1106.sendBuffer();
    return;
  }

  Serial.println("U8g2: SH1106 failed, trying SSD1306...");
  u8g2_ssd1306.setI2CAddress(OLED_ADDR<<1);
  if (u8g2_ssd1306.begin()) {
    Serial.println("U8g2: SSD1306 init OK");
    u8g2_ssd1306.clearBuffer();
    u8g2_ssd1306.setFont(u8g2_font_6x10_tf);
    u8g2_ssd1306.drawStr(0, 12, "SSD1306 OK");
    u8g2_ssd1306.drawStr(0, 28, "SDA=D8 SCL=D9");
    u8g2_ssd1306.drawStr(0, 44, "ADDR 0x3C/0x3D");
    u8g2_ssd1306.sendBuffer();
    return;
  }

  Serial.println("U8g2: both inits failed; check wiring/address.");
}

void loop() {}
